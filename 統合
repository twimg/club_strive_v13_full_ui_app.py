import streamlit as st
import pandas as pd

# ====== èƒŒæ™¯CSSï¼ˆç”»åƒURLã¯ä»®ã®ã‚‚ã®ã€‚å®Ÿç’°å¢ƒç”¨ã«å·®ã—æ›¿ãˆã¦ãã ã•ã„ï¼‰ ======
def set_bg():
    st.markdown(
        """
        <style>
        .stApp {
            background-image: url("https://images.unsplash.com/photo-1609263652323-f90c426b1b10");
            background-size: cover;
        }
        .block {
            background-color: rgba(255, 255, 255, 0.85);
            padding: 1.5rem;
            border-radius: 10px;
            margin-bottom: 1rem;
        }
        </style>
        """,
        unsafe_allow_html=True
    )

# ====== CSV èª­ã¿è¾¼ã¿ ======
@st.cache_data
def load_data():
    players = pd.read_csv("players.csv")
    stats = pd.read_csv("player_stats.csv")
    traits = pd.read_csv("national_traits.csv")
    ai_clubs = pd.read_csv("ai_clubs.csv")
    offers = pd.read_csv("transfer_offers.csv")
    scouted = pd.read_csv("scouted_players.csv")
    return players, stats, traits, ai_clubs, offers, scouted

# ====== ãƒ¡ã‚¤ãƒ³ ======
def main():
    set_bg()
    players, stats, traits, ai_clubs, offers, scouted = load_data()

    st.title("âš½ Club Strive - v13 Full UI App")

    menu = st.sidebar.radio("ãƒ¡ãƒ‹ãƒ¥ãƒ¼", ["é¸æ‰‹ä¸€è¦§", "AIã‚¯ãƒ©ãƒ–", "ç§»ç±ã‚ªãƒ•ã‚¡ãƒ¼", "ã‚¹ã‚«ã‚¦ãƒˆ", "è©¦åˆçµæœ"])

    if menu == "é¸æ‰‹ä¸€è¦§":
        st.markdown('<div class="block">', unsafe_allow_html=True)
        st.header("é¸æ‰‹æƒ…å ±")
        merged = pd.merge(players, stats, on="id", how="left")
        st.dataframe(merged)
        st.markdown('</div>', unsafe_allow_html=True)

    elif menu == "AIã‚¯ãƒ©ãƒ–":
        st.markdown('<div class="block">', unsafe_allow_html=True)
        st.header("AIã‚¯ãƒ©ãƒ–ä¸€è¦§")
        st.dataframe(ai_clubs)
        st.markdown('</div>', unsafe_allow_html=True)

    elif menu == "ç§»ç±ã‚ªãƒ•ã‚¡ãƒ¼":
        st.markdown('<div class="block">', unsafe_allow_html=True)
        st.header("ç§»ç±ã‚ªãƒ•ã‚¡ãƒ¼å±¥æ­´")
        st.dataframe(offers)
        st.markdown('</div>', unsafe_allow_html=True)

    elif menu == "ã‚¹ã‚«ã‚¦ãƒˆ":
        st.markdown('<div class="block">', unsafe_allow_html=True)
        st.header("ã‚¹ã‚«ã‚¦ãƒˆå€™è£œ")
        with st.expander("ğŸ” çµã‚Šè¾¼ã¿æ¤œç´¢"):
            pos = st.selectbox("ãƒã‚¸ã‚·ãƒ§ãƒ³", ["All"] + list(players["ãƒã‚¸ã‚·ãƒ§ãƒ³"].unique()))
            free = st.checkbox("ç¾åœ¨ãƒ•ãƒªãƒ¼ã®é¸æ‰‹ã®ã¿")
            years = st.slider("å¥‘ç´„æ®‹å¹´æ•°", 0, 5, (0, 5))
        filtered = scouted.copy()
        if pos != "All":
            filtered = filtered[filtered["ãƒã‚¸ã‚·ãƒ§ãƒ³"] == pos]
        if free:
            filtered = filtered[filtered["æ‰€å±ã‚¯ãƒ©ãƒ–"] == "ãƒ•ãƒªãƒ¼"]
        filtered = filtered[(filtered["å¥‘ç´„æ®‹å¹´æ•°"] >= years[0]) & (filtered["å¥‘ç´„æ®‹å¹´æ•°"] <= years[1])]
        st.dataframe(filtered)
        st.markdown('</div>', unsafe_allow_html=True)

    elif menu == "è©¦åˆçµæœ":
        st.markdown('<div class="block">', unsafe_allow_html=True)
        st.header("è©¦åˆãƒ­ã‚°ï¼ˆç°¡æ˜“ï¼‰")
        match_log = pd.read_csv("match_log.csv") if "match_log.csv" in locals() else pd.DataFrame()
        st.dataframe(match_log)
        st.markdown('</div>', unsafe_allow_html=True)

if __name__ == "__main__":
    main()
